<h2 class="text-center mb-4">Afisare Produse</h2>

@if (ViewBag.Message != null)
{
    <h2 class="alert-success p-3 rounded-3 text-center mb-5">@ViewBag.Message</h2>
}

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <h4>Categorii</h4>
            <form id="filterForm">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="allProducts" name="allProducts" value="true" onchange="applyFilter()">
                    <label class="form-check-label" for="allProducts">Toate Produsele</label>
                </div>
                @foreach (var category in ViewBag.Categories)
                {
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="category-@category.Id" name="categoryIds" value="@category.Id" onchange="applyFilter()">
                        <label class="form-check-label" for="category-@category.Id">@category.CategoryName</label>
                    </div>
                }
            </form>
        </div>

        <div class="col-md-9" id="productContainer">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                @foreach (var product in ViewBag.Products)
                {
                    if (@product.IsVisible)
                    {
                        <div class="col">
                            <div class="card shadow-sm border-0 h-100">
                                <div class="position-relative overflow-hidden" style="height: 300px;">
                                    <img src="@product.Image" alt="Product Image" class="card-img-top" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title text-truncate">@product.Title</h5>
                                    <p class="card-text text-success fw-bold fs-5">€@product.Price</p>
                                    <p class="card-text text-muted mb-3">
                                        <i class="bi bi-globe me-1"></i>@product.Category.CategoryName
                                    </p>
                                    <div class="stock-message mb-3">
                                        @if (product.Stock > 10)
                                        {
                                            <span class="text-success fw-bold">In Stoc</span>
                                        }
                                        else if (product.Stock > 0 && product.Stock <= 10)
                                        {
                                            <span class="text-warning fw-bold">Stoc limitat - Doar @product.Stock produse ramase!</span>
                                        }
                                        else
                                        {
                                            <span class="text-danger fw-bold">Stoc epuizat</span>
                                        }
                                    </div>
                                    <a class="btn btn-primary mt-auto w-100" href="/Products/Show/@product.Id">Afisare Produs</a>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>


<script>
    function applyFilter() {
        const form = document.getElementById("filterForm");
        const formData = new FormData(form);
        const selectedCategories = Array.from(formData.getAll("categoryIds"));
        const allProducts = formData.get("allProducts") === "true";

        let query = allProducts ? "" : selectedCategories.map(id => `categoryIds=${id}`).join("&");

        fetch(`/Products/Index?${query}`, {
            method: "GET",
            headers: {
                "X-Requested-With": "XMLHttpRequest" 
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById("productContainer").innerHTML = html;
        })
        .catch(error => console.error("Error fetching products:", error));
    }
</script>



<style>
    .card:hover .card-img-top {
        transform: scale(1.1);
    }

    .card {
        transition: box-shadow 0.3s ease;
    }

        .card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

    .form-check {
        margin-bottom: 10px;
    }
</style>
